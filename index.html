<!DOCTYPE html>
<html class="no-js">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <title>veraid</title>
    <link href="images/logo-icon.svg" rel="icon" type="image/svg">
    <script>var pathToRoot = "";</script>
    <script>document.documentElement.classList.replace("no-js","js");</script>
    <script>const storage = localStorage.getItem("dokka-dark-mode")
    if (storage == null) {
        const osDarkSchemePreferred = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
        if (osDarkSchemePreferred === true) {
            document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
    } else {
        const savedDarkMode = JSON.parse(storage)
        if(savedDarkMode === true) {
            document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
    }
    </script>
<script type="text/javascript" src="https://unpkg.com/kotlin-playground@1/dist/playground.min.js" async="async"></script>
<script type="text/javascript" src="scripts/sourceset_dependencies.js" async="async"></script>
<link href="styles/style.css" rel="Stylesheet">
<link href="styles/main.css" rel="Stylesheet">
<link href="styles/prism.css" rel="Stylesheet">
<link href="styles/logo-styles.css" rel="Stylesheet">
<link href="styles/font-jb-sans-auto.css" rel="Stylesheet">
<script type="text/javascript" src="scripts/clipboard.js" async="async"></script>
<script type="text/javascript" src="scripts/navigation-loader.js" async="async"></script>
<script type="text/javascript" src="scripts/platform-content-handler.js" async="async"></script>
<script type="text/javascript" src="scripts/main.js" defer="defer"></script>
<script type="text/javascript" src="scripts/prism.js" async="async"></script>
<script type="text/javascript" src="scripts/symbol-parameters-wrapper_deferred.js" defer="defer"></script>
</head>
<body>
    <div class="root">
<nav class="navigation" id="navigation-wrapper">
    <div class="navigation--inner">
        <div class="navigation-title">
            <button class="menu-toggle" id="menu-toggle" type="button">toggle menu</button>
            <div class="library-name">
                    <a class="library-name--link" href="index.html">
                            veraid
                    </a>
            </div>
            <div class="library-version">
1.0.0            </div>
        </div>
        <div class="filter-section" id="filter-section">
                <button class="platform-tag platform-selector jvm-like" data-active="" data-filter=":dokkaHtml/main">jvm</button>
        </div>
    </div>
    <div class="navigation-controls">
        <button class="navigation-controls--btn navigation-controls--theme" id="theme-toggle-button" type="button">switch theme</button>
        <div class="navigation-controls--btn navigation-controls--search" id="searchBar" role="button">search in API</div>
    </div>
</nav>
        <div id="container">
            <div class="sidebar" id="leftColumn">
                <div class="sidebar--inner" id="sideMenu"></div>
            </div>
            <div id="main">
<div class="main-content" id="content" pageIds="veraid::////PointingToDeclaration//769193423">
  <div class="breadcrumbs"></div>
  <div class="cover ">
    <h1 class="cover"><span><span>veraid</span></span></h1>
    <div class="platform-hinted UnderCoverText" data-platform-hinted="data-platform-hinted"><div class="content sourceset-dependent-content" data-active="" data-togglable=":dokkaHtml/main"><p class="paragraph">This is the JVM/Kotlin implementation of <a href="https://veraid.net">VeraId</a>, an offline authentication protocol powered by DNSSEC. This library implements all the building blocks that signature producers and consumers need.</p><p class="paragraph">The latest version can be found on <a href="https://central.sonatype.com/search?q=veraid&amp;namespace=tech.relaycorp">Maven Central</a>, and the source code on <a href="https://github.com/relaycorp/veraid-jvm">GitHub</a>.</p><h2 class=""> Signature production</h2><p class="paragraph">To produce a signature for a given plaintext, you need a <i>Member Id Bundle</i> (produced by a VeraId organisation; e.g., via <a href="https://github.com/relaycorp/veraid-authority">VeraId Authority</a>) and the Member's private key.</p><p class="paragraph">For example, if you wanted to produce signatures valid for up to 30 days for a service identified by the <a href="https://en.wikipedia.org/wiki/Object_identifier">OID</a> <code class="lang-kotlin">1.2.3.4.5</code>, you could implement the following function and call it in your code:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">import java.security.PrivateKey<br>import java.time.ZonedDateTime<br>import kotlin.time.Duration.Companion.days<br>import kotlin.time.toJavaDuration<br>import tech.relaycorp.veraid.pki.MemberIdBundle<br>import tech.relaycorp.veraid.SignatureBundle<br><br>val TTL = 30.days<br>val SERVICE_OID = &quot;1.2.3.4.5&quot;<br><br>fun produceSignature(<br>    plaintext: ByteArray,<br>    memberIdBundleSerialised: ByteArray,<br>    memberSigningKey: PrivateKey,<br>): ByteArray {<br>    val memberIdBundle = MemberIdBundle.deserialise(memberIdBundleSerialised)<br>    val expiryDate = ZonedDateTime.now().plus(TTL.toJavaDuration())<br>    val signatureBundle = SignatureBundle.generate(<br>        plaintext,<br>        SERVICE_OID,<br>        memberIdBundle,<br>        memberSigningKey,<br>        expiryDate,<br>    )<br>    return signatureBundle.serialise()<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">The Signature Bundle contains the Member Id Bundle and the actual signature, but it does not include the <code class="lang-kotlin">plaintext</code>.</p><p class="paragraph">Note that for signatures to actually be valid for up to 30 days, the TTL override in the VeraId TXT record should allow 30 days or more.</p><h2 class=""> Signature verification</h2><p class="paragraph">To verify a VeraId signature, you simply need the Signature Bundle and the plaintext to be verified. For extra security, this library also requires you to confirm the service where you intend to use the plaintext.</p><p class="paragraph">If VeraId's maximum TTL of 90 days or the TTL specified by the signature producer may be too large for your application, you may also want to restrict the validity period of signatures.</p><p class="paragraph">For example, if you only want to accept signatures valid for the past 30 days in a service identified by <code class="lang-kotlin">1.2.3.4.5</code>, you could use the following function:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">import java.security.PrivateKey<br>import java.time.ZonedDateTime<br>import kotlin.time.Duration.Companion.days<br>import kotlin.time.toJavaDuration<br>import tech.relaycorp.veraid.pki.MemberIdBundle<br>import tech.relaycorp.veraid.SignatureBundle<br>import tech.relaycorp.veraid.SignatureException<br><br>val TTL = 30.days<br>val SERVICE_OID = &quot;1.2.3.4.5&quot;<br><br>suspend fun verifySignature(<br>    plaintext: ByteArray,<br>    signatureBundleSerialised: ByteArray,<br>): String {<br>    val signatureBundle = SignatureBundle.deserialise(signatureBundleSerialised)<br>    <br>    val now = ZonedDateTime.now()<br>    val verificationPeriod = now.minus(TTL.toJavaDuration())..now<br>    val (_, member) = try {<br>        signatureBundle.verify(plaintext, SERVICE_OID, verificationPeriod)<br>    } catch (exc: SignatureException) {<br>        throw Exception(&quot;Invalid signature bundle&quot;, exc)<br>    }<br>    <br>    return if (member.userName == null) member.orgName else &quot;${member.userName}@${member.orgName}&quot;<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph"><code class="lang-kotlin">verifySignature()</code> will return the id of the member that signed the plaintext, which looks like <code class="lang-kotlin">user@example.com</code> if the member is a user or simply <code class="lang-kotlin">example.com</code> if the member is a bot (acting on behalf of the organisation <code class="lang-kotlin">example.com</code>).</p></div></div>
  </div>
  <h2 class="">Packages</h2>
  <div class="table"><a data-name="448719494%2FPackages%2F769193423" anchor-label="tech.relaycorp.veraid" id="448719494%2FPackages%2F769193423" data-filterable-set=":dokkaHtml/main"></a>
    <div class="table-row" data-filterable-current=":dokkaHtml/main" data-filterable-set=":dokkaHtml/main">
      <div>
        <div class="main-subrow ">
          <div class=""><span class="inline-flex">
              <div><a href="veraid/tech.relaycorp.veraid/index.html">tech.relaycorp.veraid</a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="448719494%2FPackages%2F769193423"></span>
                <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
              </span></span></div>
          <div class="pull-right">
            <div class="platform-tags no-gutters">
              <div class="platform-tag jvm-like">jvm</div>
            </div>
          </div>
        </div>
        <div><span class="brief-comment"><a data-name="448719494%2FPackages%2F769193423" anchor-label="tech.relaycorp.veraid" id="448719494%2FPackages%2F769193423" data-filterable-set=":dokkaHtml/main"></a>
            <p class="paragraph">Root package for the VeraId library.</p>
          </span></div>
      </div>
    </div>
<a data-name="1840071425%2FPackages%2F769193423" anchor-label="tech.relaycorp.veraid.dns" id="1840071425%2FPackages%2F769193423" data-filterable-set=":dokkaHtml/main"></a>
    <div class="table-row" data-filterable-current=":dokkaHtml/main" data-filterable-set=":dokkaHtml/main">
      <div>
        <div class="main-subrow ">
          <div class=""><span class="inline-flex">
              <div><a href="veraid/tech.relaycorp.veraid.dns/index.html">tech.relaycorp.veraid.dns</a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="1840071425%2FPackages%2F769193423"></span>
                <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
              </span></span></div>
          <div class="pull-right">
            <div class="platform-tags no-gutters">
              <div class="platform-tag jvm-like">jvm</div>
            </div>
          </div>
        </div>
        <div><span class="brief-comment"><a data-name="1840071425%2FPackages%2F769193423" anchor-label="tech.relaycorp.veraid.dns" id="1840071425%2FPackages%2F769193423" data-filterable-set=":dokkaHtml/main"></a>
            <p class="paragraph">DNS- and DNSSEC-related functionality.</p>
          </span></div>
      </div>
    </div>
<a data-name="1305361254%2FPackages%2F769193423" anchor-label="tech.relaycorp.veraid.pki" id="1305361254%2FPackages%2F769193423" data-filterable-set=":dokkaHtml/main"></a>
    <div class="table-row" data-filterable-current=":dokkaHtml/main" data-filterable-set=":dokkaHtml/main">
      <div>
        <div class="main-subrow ">
          <div class=""><span class="inline-flex">
              <div><a href="veraid/tech.relaycorp.veraid.pki/index.html">tech.relaycorp.veraid.pki</a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="1305361254%2FPackages%2F769193423"></span>
                <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
              </span></span></div>
          <div class="pull-right">
            <div class="platform-tags no-gutters">
              <div class="platform-tag jvm-like">jvm</div>
            </div>
          </div>
        </div>
        <div><span class="brief-comment"><a data-name="1305361254%2FPackages%2F769193423" anchor-label="tech.relaycorp.veraid.pki" id="1305361254%2FPackages%2F769193423" data-filterable-set=":dokkaHtml/main"></a>
            <p class="paragraph">VeraId's public key infrastructure (e.g., X.509 certificate processing).</p>
          </span></div>
      </div>
    </div>
<a data-name="1573620943%2FPackages%2F769193423" anchor-label="tech.relaycorp.veraid.utils.x509" id="1573620943%2FPackages%2F769193423" data-filterable-set=":dokkaHtml/main"></a>
    <div class="table-row" data-filterable-current=":dokkaHtml/main" data-filterable-set=":dokkaHtml/main">
      <div>
        <div class="main-subrow ">
          <div class=""><span class="inline-flex">
              <div><a href="veraid/tech.relaycorp.veraid.utils.x509/index.html">tech.relaycorp.veraid.utils.x509</a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="1573620943%2FPackages%2F769193423"></span>
                <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
              </span></span></div>
          <div class="pull-right">
            <div class="platform-tags no-gutters">
              <div class="platform-tag jvm-like">jvm</div>
            </div>
          </div>
        </div>
        <div></div>
      </div>
    </div>
  </div>
</div>
      <div class="footer">
        <span class="go-to-top-icon"><a href="#content" id="go-to-top-link"></a></span><span>Â© 2023 Copyright</span><span
                class="pull-right"><span>Generated by </span><a
                href="https://github.com/Kotlin/dokka"><span>dokka</span><span class="padded-icon"></span></a></span>
      </div>
            </div>
        </div>
    </div>
</body>
</html>
